<section class="page-container">
  <h2>Welcome to your Dashboard!</h2>
  <p>{{ message }}</p>

  <div class="user-info" *ngIf="user">
    <h3>Your Info</h3>
    <ul>
      <li><strong>Name:</strong> {{ user.name }}</li>
      <li><strong>Email:</strong> {{ user.email }}</li>
    </ul>

    <h3>Your Active Subscriptions</h3>

    <!-- Check the correct array: stripeSubscriptions -->
    <div *ngIf="!stripeSubscriptions || stripeSubscriptions.length === 0">
      <p>You have no active subscriptions.</p>
    </div>

    <!-- Loop over the correct array: stripeSubscriptions -->
    <div *ngFor="let sub of stripeSubscriptions" class="subscription-item">
      <!-- The path to the plan name is different in the Stripe API response -->
      <p><strong>Plan:</strong> {{ sub.plan.product.name }}</p>
      <p><strong>Status:</strong> {{ sub.status }}</p>

      <!-- It's good practice to only show the cancel button if it's possible to cancel -->
      <button
        *ngIf="sub.status === 'active' || sub.status === 'trialing'"
        (click)="cancelSubscription(sub.id)"
      >
        Cancel
      </button>
    </div>

    <h3>Your Donations</h3>
    <ul *ngIf="donations.length > 0; else noDonations">
      <li *ngFor="let donation of donations">
        💖 {{ donation.amount | currency }} on
        {{ donation.date | date : "mediumDate" }}
      </li>
    </ul>
    <ng-template #noDonations>
      <p>You haven't donated yet. 🙁</p>
    </ng-template>

    <button (click)="toggleDonationForm()" class="donate-button">
      Make a Donation
    </button>

    <button (click)="startSubscription()" class="donate-button">
      Donate Monthly
    </button>

    <form
      *ngIf="showDonationForm"
      (ngSubmit)="submitDonation()"
      #donationForm="ngForm"
      class="donation-form"
    >
      <label for="amount">Donation Amount</label>
      <input
        type="number"
        id="amount"
        name="amount"
        required
        [(ngModel)]="donationAmount"
        min="1"
      />

      <button type="submit">Donate</button>
    </form>
  </div>
</section>
